# 数据预处理

### 源数据已有特征

| route_id | 路线编号／标识 | 0, 1 | 标识一次骑手的“路线”或任务集合／一个行程周期 |
| --- | --- | --- | --- |
| courier_id | 骑手编号 | 10007871 | 哪个骑手执行该路线 |
| date | 日期（格式：YYYYMMDD） | 20200201（即 2020-02-01） | 该路线对应的日期 |
| no_act | 动作（action）总数 | 7.0, 9.0 | 路线中包含的动作总数（assign、pickup、delivery等） |
| act_lst | 动作列表 | ["ASSIGN", "PICKUP", "DELIVERY", …] | 动作按时间顺序发生的动作类型列表 |
| r_time_lst | 时间戳列表（Unix 时间戳，单位：秒） | [1580526975, 1580527779, …] | 与动作相关的时间戳列表（Unix 时间戳） |
| r_dis_lst | 每段“任务动作之间/导航”距离列表（单位：米） | [377.0, 780.0, …] | 两个连续动作之间的骑行距离（或任务距离）列表 |
| r_dur_all | 该路线中活动持续总时长或骑行总时长（单位：秒） | 2469.0 | 整个路线从开始到结束所用时间长度（秒或分钟，要确认单位） |
| r_dis_all | 该路线中骑行／运输距离总和（单位：米） | 3630.0 | 整个路线骑行（或服务）距离总和 |
| no_nav | 导航段数 | 6.0, 8.0 | 导航（即从一个点移动至下一个点所需导航路径）次数 |
| nav_dis | 导航距离总和（单位：米） | 7731.0, 8618.0 | 导航所走的总距离 |
| nav_dur | 导航持续时长总和（单位：秒） | 2954.0, 3127.0 | 导航所用时间总和 |
| rider_lvl | 骑手等级 | 3.0 | 骑手等级（可能和经验或评分有关） |
| rider_spd | 骑手的平均速度或记录速度（单位：米/秒） | 4.7518319448609283 | 骑手的平均速度（可能基于该路线，或是历史平均速度，这里先看作是这条路线的吧） |
| max_load | 最大可承载／最大负载数 | 11.0 | 在该路线中骑手所承载或可承载的最大负载量 |
| wthr_grd | 天气等级或描述 | “正常天气” | 天气情况等级／描述 |
| feature_type | 特征类型（“route” 表示整条路线；“action_point” 表示单个动作点） | “route”, “action_point” | 当前 JSON 对象代表的类型，是“路线（route）”还是“动作点（action_point）” |
| act_pt_id | 当 feature_type = “action_point” 时，动作点的标识 | “0000001” | 动作点唯一标识（当类型为动作点时） |
| act_time | 当 feature_type = “action_point” 时，动作发生的时间（Unix 时间戳） | 1580526975.0 | 该动作发生的时间 |
| act_order | 当 feature_type = “action_point” 时，动作的顺序号 | 1.0 | 动作在该路线中的顺序 |
| action_type | 当 feature_type = “action_point” 时，具体动作类型 | “ASSIGN” | 动作类型，如“ASSIGN”（接单）、“PICKUP”（取餐）、“DELIVERY”（送达）。 |

### 基于已有数据构建哪些特征？

1. **个体行为特征**
    
    
    | **特征** | **含义** | **计算方式** |
    | --- | --- | --- |
    | **订单频率 (order_rate)** | 一定时间内的任务数量 | `no_act / 活动时间段长度（小时）` |
    | **平均配送间隔时间 (avg_interval)** | 骑手两次“PICKUP”或“DELIVERY”之间的平均间隔 | 连续时间差均值：`np.mean(np.diff(r_time_lst))` |
    | **连续任务量 (continuous_orders)** | 无明显休息的连续任务数 | 若两任务时间间隔 < 10min，则属于同一连续工作段 |
    | **任务负载强度 (load_intensity)** | 当前任务负载与最大负载的比值 | `当前活跃订单数 / max_load` |
    | **任务多样性 (act_entropy)** | 骑手操作类型的多样性 | `entropy(act_lst)` (信息熵) |
2. **时序动态特征**
    
    
    | **特征** | **含义** | **计算方式** |
    | --- | --- | --- |
    | **平均配送速度 (avg_speed)** | 实际骑行速度 | `r_dis_all / r_dur_all` |
    | **与骑手等级期望速度差 (spd_dev)** | 实际速度与同等级平均速度差异 | `rider_spd - avg_lvl_speed[rider_lvl]` |
    | **任务密度 (task_density)** | 每分钟执行的动作数 | `no_act / (r_dur_all / 60)` |
    | **平均导航时长占比 (nav_ratio)** | 导航时长在总时长中的比例 | `nav_dur / (r_dur_all + nav_dur)` |
    | **单位距离任务数 (task_per_km)** | 每公里完成的任务数 | `no_act / (r_dis_all / 1000)` |
3. **空间特征**
    
    
    | **特征** | **含义** | **计算方式** |
    | --- | --- | --- |
    | **平均路径曲折度 (route_curvature)** | 路径的复杂程度（弯曲多的区域更耗时） | `实际行驶距离 / 起终点直线距离` |
    | **平均停留点密度 (stop_density)** | 停留点（低速或等待）数量密度 | 在速度 < 1m/s 时的点计数 / 总点数 |
    | **高压区重叠率 (stress_area_ratio)** | 所在区域是否处于历史高压区 | 历史空间聚类(DBSCAN/ST-DBSCAN)的标签匹配比率 |
4. **环境压力**
    
    
    | 特征 | 含义 | 计算方式 |
    | --- | --- | --- |
    | **天气等级 (weather_score)** | 从“正常天气”“下雨”“高温”等映射到数值 | 正常=0，恶劣=1 |
    | **时间段 (time_of_day)** | 高峰/低峰时段分类 | 根据 `act_time` 分时段(午餐/晚餐高峰等) |
    | **区域拥堵度 (congestion_index)** | 根据平均速度反推交通拥堵程度 | `1 - (avg_speed / city_avg_speed)` |