# 时空预测模型

### 时空图序列建模

1. 图节点定义：骑手
2. 图边定义：骑手↔骑手，因为基于地理邻近性（距离相似面临相似的交通状况与订单环境）和路网连通性（路网上的最短路径小于阈值）、
3. 构造时空图序列：
    - **时间切片 (Time Slicing):** 将你的历史数据按固定的时间间隔（如**每分钟**）进行切片。
    - **为每个切片构建图快照 G_t:**
        - G_t 包含了在 t 时刻所有活跃的骑手节点。
        - 每个节点 v_i 在 t 时刻都有一组**特征向量 X_t(v_i)**。
            - **环境特征（X-features）：** 该骑手所在位置的天气、是否高峰期、POI密度等。这些是你用来预测的输入特征。
            - **状态特征：** 该骑手当前的负载、已连续工作时长等。
        - 每个节点 v_i 在 t 时刻还有一个**目标标签 Y_t(v_i)**：
            - **这就是你计算出的那个“压力分数”！**
    - **最终产出：** 你会得到一个很长的数据序列 [(G_0, Y_0), (G_1, Y_1), ..., (G_T, Y_T)]。

### 准备输入输出样本

1. 定义历史窗口和预测窗口
2. 基于原有序列生成滑动窗口采样

### 训练STGCN模型

1. **模型架构：**
    - 一个典型的STGCN模型由多个**时空卷积块 (Spatio-Temporal Conv Block)** 堆叠而成。
    - **每个时空块内部包含：**
        - **时间卷积层 (Temporal Conv):** 通常是1D卷积或GRU。它负责捕捉**单个节点**在历史窗口 P 内的时间演变规律。比如，一个骑手的压力是如何随时间积累的。
        - **空间卷积层 (Spatial Conv):** 通常是图卷积网络 (GCN) 或图注意力网络 (GAT)。它负责在**某个时间点**上，聚合邻居节点的信息。比如，一个骑手的压力会受到周边其他骑手状态的影响。
        - 这两个层交替作用，使得模型能够同时学习时间和空间上的依赖关系。
2. **训练过程：**
    - **输入：** 将X_sample和邻接矩阵A输入到STGCN模型中。
    - **输出：** 模型会输出一个对未来Q个时间步的压力分数的预测Ŷ_sample。
    - **损失函数：** 使用**均方误差 (MSE)** 或 **平均绝对误差 (MAE)** 来计算预测值Ŷ_sample和真实值Y_sample之间的差距。
        
        loss = MSE(Ŷ_sample, Y_sample)
        
    - **优化器：** 使用Adam等优化器，通过反向传播来最小化损失函数，更新模型的权重。
    - **迭代：** 重复以上过程，直到模型在验证集上的损失不再下降。

### 模型评估与检验

1. 评估指标
    - RMSE/MAE
2. 可视化验证